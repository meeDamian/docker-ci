name: build

#on:
#  push:
#    branches:
#    - master

on: push

jobs:
  faster:
    name: build
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1

    - name: All
      run: docker build -t sample-image --file Dockerfile .

    - name: Save all build containers to files
      run: >
        mkdir -p out/ &&
        docker images sample-image --format "{{.Repository}}:{{.Tag}}" | xargs -I% sh -c "docker save % | gzip > out/%.tgz" &&
        for file in $(ls out/); do
          mv out/${file} out/$(echo ${file} | tr : -)
        done

    - name: extract file from container
      run: |
        ls -la
        ID=$(docker create sample-image)
        docker cp "${ID}:/files/" out/
        docker rm -v "${ID}"

    - name: Upload
      uses: actions/upload-artifact@master
      with:
        name: containers
        path: out/


    - name: Update README & description on Docker Hub
      if: startsWith(github.ref, 'refs/tags/')
      uses: meeDamian/sync-readme@v1.0.4
      with:
        pass: ${{ secrets.DOCKER_PASS }}
        description: true



